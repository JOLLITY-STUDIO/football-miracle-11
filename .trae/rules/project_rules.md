# 项目开发规范

## 1. 对决系统 (Duel System) 规范

为了保证对决过程透明、合理且具备仪式感，对决系统必须严格遵循以下阶段和步骤。

### 对决阶段 (Stages) 与 步骤 (Steps)

| 阶段 (Stage) | 步骤 (Step) | 说明 | 结算结果 (Result) |
|-------------|------------|------|-------------------|
| **1. 准备 (Preparation)** | 1.1 初始化对决 | 展示对决双方球员 | - |
| **2. 基础对决 (Base Power)** | 2.1 进攻方基础 | 展示进攻球员基础力量 | 进攻方初始值 |
| | 2.2 防守方基础 | 展示防守球员基础力量 | 防守方初始值 |
| **3. 增益结算 (Buffs)** | 3.1 协同加成 | 翻开盖放的协同卡并计算加成 | 双方力量累加 |
| | 3.2 技能激活 | 展示并计算激活的球员技能 | 最终力量确定 |
| **4. 总结与结果 (Conclusion)** | 4.1 对决总结 | 展示最终力量对比与加成明细 | 阶段总结 |
| | 4.2 最终结果 | 展示进球、扑救或射失动画 | 对决结果 |

### UI 实现要求
- **阶段信息展示**：每个阶段开始时，需在显著位置展示当前阶段名称（如 Stage 2）。
- **步骤信息展示**：每个步骤开始时，展示当前步骤的动作描述。
- **动态结算**：力量数值必须采用递增动画，禁止瞬间跳变。
- **协同卡盖放**：协同卡必须先以背面（Face Down）状态进入场上，待到 3.1 步骤时统一翻开。
- **可追溯性**：所有对决步骤必须记录在 `matchLogs` 中，方便玩家随时查看。

## 2. AI 动作规范
- **视觉反馈**：AI 的动作（抽卡、放卡、射门）必须有明确的停顿和视觉提示，不能在后台静默完成。
- **协同卡展示**：AI 在射门或防守时选择协同卡的过程，必须在 UI 上体现出“正在选牌”和“盖牌”的动作。

## 3. 代码结构规范
- **组件化**：UI 功能模块必须解耦，如 `MatchLog`, `DuelOverlay`, `SynergyPanel` 等。
- **状态驱动**：游戏逻辑必须由 `gameLogic.ts` 中的 `GameState` 统一驱动，组件仅负责渲染状态。
- **日志记录**：关键操作（Action）必须调用 `addLog` 记录。

---

## 4. 环境与提交规范
- 自行检查新 3D 环境，确保预览无误。
- 提交代码前检查语法与逻辑错误。
- 以双人对战视角考虑 UI 布局。

当一个设计师想要推演自己的游戏新加入某个规则会怎样，或者反向剖析他人的游戏，则建议使用机制－运行－体验的分析方法，然后按ERG需求理论（在第三卷会有详细论述），导入不同类型的用户模型，模拟推演他们在自己设计中的行为，之后谨慎地调整自己的系统机制，以保证综合最优。
当一个策划检查自己游戏的体验好不好时，最好使用表现－机制－灵魂的检查方式，看自己能否在忘记原有规则的情况下，只靠少量系统提示（当然也有可能你根本没做任何提示），即可从表现感知到规则甚至灵魂。《皇室战争》即是典型的成功案例，在网络互联操作系统(Internetworking Operating System-Cisco，IOS)美服中，其作为创新游戏，它的次日留存（指第二天，依然登录游戏的用户百分比）甚至可以好到77%，这与其顶级的表现层设计是分不开的。
结合使用以上3种方法，可以很好地帮助大家理解游戏在不同情况下的运行状态。我们可以发现游戏在不同的情况下展现了不同的姿态，我们需要用正确的方法对不同的姿态进行研究和游戏的设计制作。

哲学化也有其缺陷。越抽象的理论越泛用，但也越错误；越具体的理论越局限，但也越正确。任何真正的真理都是局部真理，但在那个局部，就是真理。
人类的本体就是五根手指。

我们实现游戏的时候应该考虑以下几点：参考《爆款方法论：游戏设计的三大核心与150个技巧》曾宜凯
提升玩家体验的方法有以下：
1. 激活玩家的肾上腺素，战斗内，从游戏进程的角度要想让玩家有更多的肾上腺素分泌，需要我们制作一个富有压力和挑战的游戏。适宜的压力与挑战让玩家“暴走”，大量分泌的肾上腺素会让玩家的体验达到新的高峰！
2. 内啡肽：战斗后，具体到游戏中，让我们的内啡肽大量分泌的往往是游戏中的各种成功，让你产生成就感。当我们收到了游戏的正面反馈， 我们就很容易分泌内啡肽。所以我们要让玩家在游戏中不断地收到好消息（一定要把好消息一条一条分次发送，而不是一次性发送大量，它将让你的玩家产生更多的内啡肽）。
3. 多巴胺:刺激用户的条件反射，强化玩家的快感。奖励玩家在游戏中成功的动作，比如进球、射门、逼抢等，都可以奖励玩家的多巴胺，让玩家在游戏中获得更多的快感。形成肌肉记忆，刚开始必须形成强烈的多巴胺。也是埋心锚。持续刺激。让玩家实现大小目标。当玩家已经理解这套游戏系统机制之后就不再产生多巴胺了。
心理学的角度。不少玩家就喜欢很虚的东西。
玩家都喜欢富有压力和挑战的游戏。
游戏是做给人玩的，无论生理心理，都需要有挑战性。这就是人性。找共性。
对美好事物的期待。玩家都喜欢对美好事物的期待。比如，他们会对自己的未来有期望，对自己的朋友有期望，对自己的家人有期望。
战斗时尽可能刺激，战斗后尽可能的成就感。让玩家获得成长的满足，立即让他使用，这就是游戏的目标。
可以在吃饭的时候玩。成本最低，快感也高。丰富易懂。先做玩法深度再实现友好度，不然缺乏可玩性，满足小部分硬核玩家（个性，好玩：心流更高更专注）到休闲大众。
如果你读过参考《爆款方法论：游戏设计的三大核心与150个技巧》曾宜凯，请按里面的方法论设计我们的游戏。
要使玩家强烈感受到游戏中的球员差异。
女性更擅长多线程切换，男性则更擅长专注做一件事。由此，娱乐性价比不同。
创新体验。娱乐性价比最大化。
娱乐性价比：游戏难度 玩家能力天赋 游戏成本 玩法吸引系数 关键成功因数，比如浏览器打开游戏的速度，游戏的操作流程是否简单明了，游戏的机制是否有趣。
玩家能力天赋：玩家自主找到游戏的核心玩法。
立体空间智能：玩家在游戏中可以感受到不同的空间位置，从而更好地理解游戏的机制。
更高的长期价值：游戏的长期价值在于玩家的长期满足和成长。玩家在游戏中获得的满足和成长，将长期影响他们的生活。从普通到高级，游戏难度越来越高级，游戏就能更硬核。
先把游戏教会玩家，再变得简易一些。
休闲游戏长期价值就逐渐变低。因为没有持续的挑战和满足，玩家会逐渐失去对游戏的兴趣。
游戏的魅力在于：整体艺术。
这个游戏的核心就是射门，力量总值11的绝对胜利✌️，所以叫做奇迹数字11，我把它叫做足球奇迹11. 就是说这个又是重点：足球 神奇 11的无敌射门必胜。这才是核心。
这个游戏来源于桌游MAGIC NUMBER ELEVEN,他这个又像21点，有数字相加达到11点基本必胜。
pve和pvp模式都有。不要太大的差异。持续优化ai的实现。不是数值就是游戏机制的问题。
交换的重要性。
音效能清晰的反馈。
保证整个项目能通，流程正确，规则正确。


协同卡只有这几种哈：1星*1,1星带铲球*2,2星*5,3星*10,4星*5,5星*2
协同卡配置（共25张）
1星：3张
1 ×1
1+铲球 ×2
2星：5张
2 ×5
3星：10张
3 ×10
4星：5张
4 ×5
5星：2张
5 ×2


战术图标的计算都是通过球场图标层自动识别激活，展示，计算来完成交互额。
选秀阶段最好能，让玩家有机会看到所有明星球员的图标，然后这些明星球员就进入到明星卡组里面，明星卡组在抽取卡，显示，然后系统自动洗牌（这里要实现洗牌动作），然后，再抽三张，在屏幕中间展示出来。然后开始进行选秀。整个实现应该是这样子。如果能还原到这种程度那真是一个成功的游戏。没有弹窗什么的，就是像真的从明星卡组里面抽取球员一样。就这样展现在眼前。这应该算是ue构思了吗？

关于球员选手：
1. 每个队伍有13名球员，其中3名是新签约的明星球员。
2. 球员选手的图标，分为战术图标，技能图标，展示在球员卡上。战术图标一般都是半圆，部分球员有完整的战术图标。
3. 战术图标有4种：进攻（射门，足球），防守（盾），协调（协同，配合），控制（压迫，逼抢）。
4. 每个球员最多有6个半圆战术图标。
5. 技能图标：
   - 每个球员最多有3个技能图标。
   - 技能图标分为2种：普通技能图标（普通），特殊技能图标（特殊）。
   - 普通技能图标：球员可以使用的普通技能,就是完整的战术图标。
   - 特殊技能图标：球员可以使用的特殊技能，如无视防守，抽协同卡+1，抽协同卡抽2选1,去对方持有的协同卡一张等。
如果有闪电符号的技能图标，那么这个球员上场的时候可以马上使用技能。由于这个时候是球员的回合，所以球员可以马上使用技能，比如射门，抽卡，逼抢等。比如球员有射门技能图标，然后他又和别人拼合了半圆射门图标，然后又是即时效果，那他就能马上是射门，然后这个时候激活的射门图标都能算在总进攻力量里面。
- 闪电技能激活时机 ：当带有闪电符号的技能图标球员上场时，技能是自动激活还是需要玩家手动触发？答： 玩家选择是否激活。
- 完整战术图标技能 ：普通技能图标（完整战术图标）和现有的 completeIcon 字段是什么关系？它们是同一个概念还是分开的？答：completeIcon我不太清楚。你在哪里看到的？
- 技能显示 ：技能图标应该在球员卡UI上如何显示？需要和战术图标区分开吗？答：技能图标一般是选手卡里面的图标表示而已，这个先按原来的实现，暂不修改，不过技能的效果需要实现。
- 技能数量限制 ：每个球员最多3个技能图标，这个限制需要在代码中验证吗？答：需要在代码中验证，确保每个球员的技能图标数量不超过3个。
- 技能效果实现 ：特殊技能（如"无视防守"、"抽协同卡+1"等）的具体效果逻辑需要在哪里实现？是在 immediateEffects.ts 中添加新的效果类型吗？答：是在 immediateEffects.ts 中添加新的效果类型。
- 技能图标点击事件 ：当玩家点击技能图标时，需要触发什么事件？是立即执行技能效果，还是需要玩家确认？答：技能图标目前只是显示用，如果有更好的UI方案可以告诉我。
completeIcon = 完整战术图标（用于力量计算）这个跟球员没关系，是球场上统计一方半场的。不在这里计算。
skills = 特殊技能图标（特殊效果）也不是特殊技能啊，就是技能啊
immediateEffect = 上场即时效果（抽卡、射门等）就是是否速攻标记啊，标记了表示技能可以马上释放啊。

关于半圆图标的显示方式：直接看.trae\rules\display-rule.md的 球员卡片显示规则这里不再赘述。该文件的球员设定是按照原桌游设定的，我们游戏按这个来。
对比使用指南：GAME_MANUAL.md检查是否有冲突，有就告诉我给我选择解决方案 ，代码修改经过，自动代码评审和验证后，对照实现更新到文档。
gen可以查看截图信息。
rules\rules.md 这份是原桌游的说明书。没有图片辅助可能有些不清楚的可以跟我讨论。
可以将原桌游规则和现实现进行比较，完善整个游戏功能。
BUG_TRACKING.md bug跟踪表，自动提交到github issues，可以随时追溯。


分步思考，不要跳步
修复问题先plan
你是资深SRE+架构师，帮我修复复杂Bug。
1. 先分析：问题根源、影响范围、风险点
2. 给出最小修复方案（只改必要代码）
3. 说明修改原因+验证方法
4. 最后给测试用例，验证修复效果

使用动漫设计过程来设计游戏，比如：
1. 先确定游戏的核心机制和规则。
2. 然后根据机制和规则，设计游戏的界面和交互。
3. 最后根据用户测试反馈，不断优化游戏设计。

要有面向对象的编程思想。