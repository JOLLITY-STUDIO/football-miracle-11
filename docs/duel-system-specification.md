# 对决系统流程说明书与验证清单

## 概述
本文档详细描述了电子桌游对决系统的完整流程，确保电子版实现与实体桌游规则完全匹配，同时提供优秀的用户体验。

## 对决系统规范

### 对决阶段与步骤

#### 阶段 1: 准备 (Preparation)
**步骤 1.1: 初始化对决**
- **触发条件**: 玩家选择射门动作
- **系统行为**: 
  - 识别进攻球员和防守球员
  - 检查进攻球员是否有可用的射门图标
  - 创建对决记录
- **UI展示**: 
  - 高亮显示对决双方球员
  - 显示"对决开始"动画
- **日志记录**: "[玩家名称] 使用 [球员名称] 发起射门对决"

#### 阶段 2: 基础对决 (Base Power)
**步骤 2.1: 进攻方基础力量展示**
- **系统行为**: 
  - 计算进攻球员基础力量值
  - 应用位置加成（如前锋+1）
  - 应用技能加成（如射门技能+2）
- **UI展示**: 
  - 显示进攻球员卡片
  - 力量值以递增动画从0增长到最终值
  - 显示力量来源明细（基础+位置+技能）
- **日志记录**: "进攻方基础力量: [数值] (基础[基础值] + 位置[加成] + 技能[加成])"

**步骤 2.2: 防守方基础力量展示**
- **系统行为**: 
  - 计算防守球员基础力量值（如有防守球员）
  - 应用位置加成（如中后卫+1）
  - 应用技能加成（如防守技能+2）
- **UI展示**: 
  - 显示防守球员卡片（如有）
  - 力量值以递增动画从0增长到最终值
  - 显示力量来源明细
- **日志记录**: "防守方基础力量: [数值]"

#### 阶段 3: 增益结算 (Buffs)
**步骤 3.1: 协同卡翻开与加成计算**
- **系统行为**: 
  - 翻开所有盖放的协同卡
  - 每张协同卡为对应方+2力量
  - 计算协同卡总加成
- **UI展示**: 
  - 协同卡从背面翻转到正面
  - 显示协同卡效果动画
  - 力量值再次递增（协同加成）
- **日志记录**: "协同卡效果: [数量]张协同卡提供 +[总加成] 力量"

**步骤 3.2: 技能激活与效果计算**
- **系统行为**: 
  - 检查并激活球员特殊技能
  - 应用技能效果（如无视防守、额外力量等）
  - 重新计算最终力量值
- **UI展示**: 
  - 显示技能激活特效
  - 更新最终力量对比
  - 高亮显示关键技能效果
- **日志记录**: "技能激活: [技能名称] - [效果描述]"

#### 阶段 4: 总结与结果 (Conclusion)
**步骤 4.1: 对决总结展示**
- **系统行为**: 
  - 对比双方最终力量值
  - 显示所有加成来源明细
  - 计算力量差值
- **UI展示**: 
  - 并排显示双方最终力量
  - 显示力量对比条
  - 列出所有加成来源
- **日志记录**: "最终力量对比 - 进攻方: [攻击力量] vs 防守方: [防守力量]"

**步骤 4.2: 最终结果展示**
- **系统行为**: 
  - 根据力量对比判定结果
  - 更新比分（如进球）
  - 应用结果效果（如球员状态更新）
- **UI展示**: 
  - 显示结果动画（进球庆祝/扑救成功/射失遗憾）
  - 更新比分显示
  - 显示结果说明
- **结果判定**:
  - 进攻方力量 > 防守方力量: 进球 (GOAL!)
  - 进攻方力量 = 防守方力量: 扑救成功 (SAVE!)
  - 进攻方力量 < 防守方力量: 射失 (MISS!)
- **日志记录**: "对决结果: [结果类型] - [详细说明]"

## 射门图标使用规则

### 图标使用追踪
- 每个球员的射门图标使用后会被记录
- 使用过的图标在界面上显示为"已使用"状态（如涂黑或标记）
- 已使用的图标在本半场内不能再次使用

### 图标重置条件
1. **替补换人**: 当球员被替换下场时，其使用的射门图标重置
2. **半场结束**: 半场结束时，所有球员的射门图标重置
3. **特殊技能**: 某些技能可能重置图标（根据具体技能描述）

### 图标选择机制
- 玩家射门时可以选择要使用的射门图标
- AI射门时系统会自动选择合适的可用图标
- 如果没有可用图标，则无法执行射门动作

## AI行为规范

### 视觉反馈要求
1. **动作停顿**: AI动作必须有明显的停顿时间（建议1-2秒）
2. **过程展示**: 所有AI决策过程必须在UI上可见
3. **状态提示**: 显示"AI思考中..."等状态提示

### 协同卡处理
1. **选牌过程**: AI选择协同卡时显示选择动画
2. **盖牌动作**: 协同卡必须以背面状态放置到场上
3. **翻牌时机**: 在阶段3.1统一翻开所有协同卡

## 用户体验增强

### 肾上腺素激活（战斗时）
- **压力营造**: 对决过程中的紧张音效和视觉效果
- **挑战感**: 力量对比的悬念营造
- **时间压力**: 适当的动画节奏控制

### 内啡肽释放（战斗后）
- **成功反馈**: 进球后的庆祝动画和音效
- **成就展示**: 详细的结果分析和加成明细
- **好消息分批**: 分步骤展示好消息（基础力量→协同加成→技能效果→最终结果）

### 多巴胺刺激（奖励机制）
- **动作奖励**: 每次成功的射门尝试都有视觉反馈
- **技能激活**: 特殊技能触发时的特效展示
- **成长感知**: 通过详细的数据展示让玩家感受到进步

## 验证清单

### 功能验证
- [ ] 对决流程是否严格按照4个阶段执行
- [ ] 每个阶段是否有明确的UI标识
- [ ] 力量计算是否准确并显示明细
- [ ] 协同卡是否正确处理（盖放→翻开）
- [ ] 射门图标使用是否正确追踪和重置
- [ ] AI行为是否符合视觉反馈要求

### 日志验证
- [ ] 所有对决步骤是否记录在matchLogs中
- [ ] 日志是否包含足够的上下文信息
- [ ] 日志是否分类正确（duel/system/action/skill/synergy/result）
- [ ] 日志是否包含时间戳和阶段信息

### 用户体验验证
- [ ] 动画是否流畅且有意义
- [ ] 信息展示是否清晰易懂
- [ ] 反馈是否及时且恰当
- [ ] 界面布局是否适合双人对战视角

### 规则一致性验证
- [ ] 电子版规则是否与实体桌游完全一致
- [ ] 特殊情况和边界条件是否正确处理
- [ ] 技能效果是否按规则正确实现
- [ ] 重置条件是否准确触发

## 测试场景

### 基础测试
1. 玩家射门无防守球员
2. 玩家射门有防守球员
3. AI射门各种情况
4. 协同卡加成测试

### 边界测试
1. 无可用射门图标
2. 力量值相等的情况
3. 特殊技能组合
4. 半场重置验证

### 性能测试
1. 连续多次射门
2. 大量日志记录
3. 动画流畅度
4. 内存使用监控

## 持续优化

### 数据收集
- 收集玩家行为数据
- 分析常见问题和困惑点
- 监控性能指标

### 反馈循环
- 定期回顾用户体验
- 根据反馈调整动画节奏
- 优化信息展示方式
- 完善特殊规则处理

---

**文档版本**: 1.0  
**最后更新**: 2024年  
**状态**: 实施中  
**验证状态**: 待验证