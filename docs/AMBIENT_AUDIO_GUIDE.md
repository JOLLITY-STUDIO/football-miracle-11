# ç¯å¢ƒéŸ³ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ç¯å¢ƒéŸ³ç³»ç»Ÿä¸ºæ¸¸æˆæä¾›äº†æ²‰æµ¸å¼çš„çƒåœºæ°›å›´ä½“éªŒï¼ŒåŒ…æ‹¬æŒç»­çš„èƒŒæ™¯ç¯å¢ƒéŸ³å’Œè§¦å‘çš„è§‚ä¼—ååº”éŸ³æ•ˆã€‚

## ç¯å¢ƒéŸ³ç±»å‹

### 1. æŒç»­ç¯å¢ƒéŸ³ (Ambient)

| ç±»å‹ | æè¿° | éŸ³é‡å»ºè®® |
|------|------|----------|
| `stadium` | çƒåœºåŸºç¡€æ°›å›´éŸ³ | 100% (åŸºå‡†) |
| `crowd` | è§‚ä¼—èƒŒæ™¯å™ªéŸ³ | 80% |
| `crowd_chant` | çƒè¿·æ­Œå”±å£° | 60% |
| `match` | æ¯”èµ›ç»¼åˆç¯å¢ƒéŸ³ | 70% |
| `wind` | é£å£°ï¼ˆæˆ·å¤–çƒåœºï¼‰ | 40% |

### 2. è§‚ä¼—ååº”éŸ³æ•ˆ

| ååº”ç±»å‹ | è§¦å‘åœºæ™¯ |
|----------|----------|
| `cheer` | è¿›çƒæ—¶ |
| `applause` | ç²¾å½©æ‰‘æ•‘ã€åŠåœºç»“æŸ |
| `ooh` | å°„é—¨åå‡ºã€é™©èƒœæ—¶åˆ» |
| `boo` | çŠ¯è§„ã€ä¸åˆ©åˆ¤ç½š |

## API ä½¿ç”¨

### åŸºç¡€å‡½æ•°

```typescript
import { 
  playAmbient, 
  stopAmbient, 
  startMatchAmbience, 
  stopMatchAmbience,
  triggerCrowdReaction 
} from '../utils/audio';

// æ’­æ”¾å•ä¸ªç¯å¢ƒéŸ³
playAmbient('stadium', 2000); // 2ç§’æ·¡å…¥

// åœæ­¢å•ä¸ªç¯å¢ƒéŸ³
stopAmbient('crowd', 1000); // 1ç§’æ·¡å‡º

// å¯åŠ¨å®Œæ•´æ¯”èµ›æ°›å›´
startMatchAmbience(); // è‡ªåŠ¨æ’­æ”¾ stadium + crowd + match

// åœæ­¢æ‰€æœ‰æ¯”èµ›æ°›å›´
stopMatchAmbience(3000); // 3ç§’æ·¡å‡º

// è§¦å‘è§‚ä¼—ååº”
triggerCrowdReaction('cheer'); // æ¬¢å‘¼
```

### React Hook

```typescript
import { useAmbience } from '../hooks/useAmbience';

function MyComponent() {
  const { 
    startAmbient, 
    endAmbient, 
    startMatchAtmosphere, 
    endMatchAtmosphere,
    crowdReact 
  } = useAmbience();

  // ä½¿ç”¨è¿™äº›å‡½æ•°æ§åˆ¶ç¯å¢ƒéŸ³
  useEffect(() => {
    startMatchAtmosphere();
    return () => endMatchAtmosphere();
  }, []);
}
```

### è‡ªåŠ¨ç®¡ç† Hook

```typescript
import { useAutoAmbience } from '../hooks/useAmbience';

function GameComponent({ phase }) {
  // æ ¹æ®æ¸¸æˆé˜¶æ®µè‡ªåŠ¨å¯åŠ¨/åœæ­¢ç¯å¢ƒéŸ³
  useAutoAmbience(phase);
  // phase === 'firstHalf' | 'secondHalf' æ—¶è‡ªåŠ¨å¯åŠ¨
  // phase === 'fullTime' æ—¶è‡ªåŠ¨åœæ­¢
}
```

## è‡ªåŠ¨è§¦å‘é€»è¾‘

### æ¯”èµ›é˜¶æ®µ

```
coinToss/setup â†’ æ— ç¯å¢ƒéŸ³
    â†“
firstHalf â†’ å¯åŠ¨æ¯”èµ›æ°›å›´ (stadium + crowd + match)
    â†“
halfTime â†’ æ’­æ”¾æŒå£°
    â†“
secondHalf â†’ ç»§ç»­æ¯”èµ›æ°›å›´
    â†“
fullTime â†’ åœæ­¢æ‰€æœ‰ç¯å¢ƒéŸ³ (3ç§’æ·¡å‡º)
```

### å°„é—¨ç»“æœ

```
è¿›çƒ (goal) â†’ æ’­æ”¾æ¬¢å‘¼å£° (cheer)
æ‰‘æ•‘ (save) â†’ æ’­æ”¾æŒå£° (applause)
å°„å (miss) â†’ æ’­æ”¾æƒŠè®¶å£° (ooh)
```

### ç‰¹æ®Šäº‹ä»¶

- **åŠåœº**: æ’­æ”¾æŒå£°
- **è¡¥æ—¶**: æ’­æ”¾æ¬¢å‘¼å£°
- **çŠ¯è§„**: å¯è§¦å‘å˜˜å£° (boo)

## éŸ³é¢‘æ–‡ä»¶ç›®å½•ç»“æ„

```
public/
â”œâ”€â”€ audio/
â”‚   â”œâ”€â”€ ambient/           # ç¯å¢ƒéŸ³æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ stadium.mp3   # çƒåœºæ°›å›´
â”‚   â”‚   â”œâ”€â”€ crowd.mp3     # è§‚ä¼—å™ªéŸ³
â”‚   â”‚   â”œâ”€â”€ crowd_chant.mp3 # çƒè¿·æ­Œå”±
â”‚   â”‚   â”œâ”€â”€ match.mp3     # æ¯”èµ›ç¯å¢ƒ
â”‚   â”‚   â””â”€â”€ wind.mp3      # é£å£°
â”‚   â”œâ”€â”€ click_new.wav     # UIç‚¹å‡»éŸ³
â”‚   â”œâ”€â”€ card_flip_new.wav # å¡ç‰Œç¿»è½¬
â”‚   â”œâ”€â”€ whistle_new.wav   # å“¨å£°
â”‚   â”œâ”€â”€ cheer_new.wav     # æ¬¢å‘¼
â”‚   â””â”€â”€ goal_new.wav      # è¿›çƒ
â””â”€â”€ bgm/                  # èƒŒæ™¯éŸ³ä¹
    â””â”€â”€ ...
```

## æ§åˆ¶é¢æ¿

æ¸¸æˆä¸­ç‚¹å‡»å·¦ä¾§é¢æ¿çš„ ğŸ”Š æŒ‰é’®å¯æ‰“å¼€ç¯å¢ƒéŸ³æ§åˆ¶é¢æ¿ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **ä¸»å¼€å…³**: å¯ç”¨/ç¦ç”¨æ‰€æœ‰ç¯å¢ƒéŸ³
2. **éŸ³é‡æ»‘å—**: è°ƒæ•´ç¯å¢ƒéŸ³æ•´ä½“éŸ³é‡ (0-100%)
3. **ç‹¬ç«‹æ§åˆ¶**: å•ç‹¬å¼€å¯/å…³é—­æ¯ç§ç¯å¢ƒéŸ³
4. **å¿«é€Ÿæ“ä½œ**: 
   - å¯åŠ¨æ¯”èµ›æ°›å›´
   - åœæ­¢æ‰€æœ‰æ°›å›´
5. **è§‚ä¼—ååº”æµ‹è¯•**: æµ‹è¯•å„ç§è§‚ä¼—ååº”éŸ³æ•ˆ

## è®¾ç½®å­˜å‚¨

ç¯å¢ƒéŸ³è®¾ç½®è‡ªåŠ¨ä¿å­˜åˆ° `localStorage`:

```json
{
  "bgm": true,
  "sfx": true,
  "ambient": true,
  "volume": 0.5,
  "ambientVolume": 0.3
}
```

## æ€§èƒ½ä¼˜åŒ–

1. **æ‡’åŠ è½½**: ç¯å¢ƒéŸ³æ–‡ä»¶åœ¨é¦–æ¬¡æ’­æ”¾æ—¶åŠ è½½
2. **æ·¡å‡ºåœæ­¢**: åœæ­¢æ—¶å¹³æ»‘æ·¡å‡ºï¼Œé¿å…çªå…€
3. **éŸ³é‡å±‚çº§**: å¤šç§ç¯å¢ƒéŸ³æ··åˆæ—¶è‡ªåŠ¨è°ƒæ•´ç›¸å¯¹éŸ³é‡
4. **äº‹ä»¶é©±åŠ¨**: åªåœ¨å¿…è¦æ—¶æ’­æ”¾éŸ³æ•ˆï¼Œå‡å°‘èµ„æºå ç”¨

## æ‰©å±•å»ºè®®

### æ·»åŠ æ–°çš„ç¯å¢ƒéŸ³

1. å°†éŸ³é¢‘æ–‡ä»¶æ”¾å…¥ `public/audio/ambient/`
2. åœ¨ `src/utils/audio.ts` ä¸­æ·»åŠ åˆ° `ambients` å¯¹è±¡
3. è®¾ç½®åˆé€‚çš„éŸ³é‡å’Œå¾ªç¯å‚æ•°

```typescript
this.ambients = {
  // ... ç°æœ‰ç¯å¢ƒéŸ³
  rain: new Howl({
    src: [`${base}audio/ambient/rain.mp3`],
    loop: true,
    volume: this.ambientVolume * 0.5,
    autoplay: false,
  }),
};
```

### æ·»åŠ æ–°çš„è§‚ä¼—ååº”

1. åœ¨ `SoundType` ç±»å‹ä¸­æ·»åŠ æ–°ç±»å‹
2. åœ¨ `sounds` å¯¹è±¡ä¸­æ·»åŠ å¯¹åº”éŸ³æ•ˆ
3. åœ¨ `triggerCrowdReaction` ä¸­æ·»åŠ è§¦å‘é€»è¾‘

## è°ƒè¯•

åœ¨æµè§ˆå™¨æ§åˆ¶å°å¯ä»¥è®¿é—®å…¨å±€éŸ³é¢‘ç®¡ç†å™¨ï¼š

```javascript
// æŸ¥çœ‹å½“å‰æ’­æ”¾çš„ç¯å¢ƒéŸ³
audioManager.getPlayingAmbients();

// æ‰‹åŠ¨æ’­æ”¾ç¯å¢ƒéŸ³
audioManager.playAmbient('stadium');

// åœæ­¢æ‰€æœ‰ç¯å¢ƒéŸ³
audioManager.stopAllAmbients();
```
