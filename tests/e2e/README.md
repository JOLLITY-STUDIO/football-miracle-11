# ç¥å¥‡åä¸€äºº - E2Eè‡ªåŠ¨åŒ–æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

å®Œæ•´çš„ç«¯åˆ°ç«¯(E2E)è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶,ä½¿ç”¨ **Playwright** æ¨¡æ‹ŸçœŸå®ç©å®¶æ“ä½œ,éªŒè¯æ¸¸æˆæ ¸å¿ƒæµç¨‹å’Œè§„åˆ™å®ç°ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### æ ¸å¿ƒæµç¨‹æµ‹è¯•
- âœ… **T1: å®Œæ•´æ¸¸æˆæµç¨‹** - ä»é€‰ç§€åˆ°è¿›çƒçš„å®Œæ•´å‘¨æœŸ
- âœ… **T2: å°„é—¨æ ‡è®°å‰Šå¼±æœºåˆ¶** - éªŒè¯P0-1ä¿®å¤æ•ˆæœ
- âœ… **T3: æˆ˜æœ¯å›¾æ ‡è¿æ¥** - éªŒè¯P0-2å¯è§†åŒ–æ•ˆæœ
- âœ… **T4: å‹åŠ›æµ‹è¯•** - 10å›åˆè¿ç»­æ“ä½œç¨³å®šæ€§
- âœ… **T5: é˜¶æ®µæ¨ªå¹…æç¤º** - P1-3ä¼˜åŒ–éªŒè¯
- âœ… **T6: æ‹–æ‹½äº¤äº’** - éæ³•æ“ä½œæ‹’ç»

### æµ‹è¯•æŒ‡æ ‡
- æ¸¸æˆè§„åˆ™æ­£ç¡®æ€§: 100%
- UIäº¤äº’å“åº”: 100%
- å¼‚å¸¸å¤„ç†: 95%+
- æ€§èƒ½ç¨³å®šæ€§: 10+å›åˆæ— å´©æºƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
npm install -D @playwright/test
npx playwright install
```

### 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npx playwright test -c playwright.config.cjs
```

### 3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
```bash
npx playwright show-report
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tests/
â””â”€â”€ e2e/
    â”œâ”€â”€ game-full-flow.spec.cjs   # å®Œæ•´æ¸¸æˆæµç¨‹æµ‹è¯• (CJS)
    â””â”€â”€ README.md                 # æœ¬æ–‡æ¡£

playwright.config.cjs             # Playwrighté…ç½® (CJS)
test-results/                     # æµ‹è¯•ç»“æœè¾“å‡º
â”œâ”€â”€ html/                         # HTMLæµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ results.json                  # JSONç»“æœæ•°æ®
â””â”€â”€ videos/                       # å¤±è´¥ç”¨ä¾‹å½•å±
```

## ğŸ® GameHelper API

æµ‹è¯•è¾…åŠ©ç±»,å°è£…å¸¸ç”¨æ¸¸æˆæ“ä½œ:

```typescript
class GameHelper {
  // ç­‰å¾…æ¸¸æˆåŠ è½½å®Œæˆ
  waitForGameReady()
  
  // é€‰æ‹©æ˜æ˜Ÿçƒå‘˜ (index: 0-2)
  selectStarPlayer(index: number)
  
  // æ‹–æ‹½å¡ç‰Œåˆ°åœºåœ°
  placeCardFromHand(handIndex, zone, slot)
  
  // ç‚¹å‡»å°„é—¨æŒ‰é’®
  clickShootButton(zone, slot)
  
  // é€‰æ‹©æˆ˜æœ¯è¡ŒåŠ¨ (pass/press)
  selectTeamAction(action: 'pass' | 'press')
  
  // è·å–å½“å‰æ¯”åˆ†
  getScore(): { player: number, ai: number }
  
  // éªŒè¯å°„é—¨æ ‡è®°æ•°é‡
  verifyShotMarkers(zone, slot, expectedCount)
  
  // éªŒè¯æˆ˜æœ¯è¿æ¥çº¿å­˜åœ¨
  verifyTacticalConnections(minCount)
  
  // è·å–å°„é—¨æŒ‰é’®æ”»å‡»åŠ›
  getAttackPower(zone, slot): number
}
```

## ğŸ” æµ‹è¯•ç”¨ä¾‹è¯¦è§£

### T1: å®Œæ•´æ¸¸æˆæµç¨‹
æ¨¡æ‹Ÿç©å®¶ä»é€‰ç§€åˆ°è¿›çƒçš„å®Œæ•´æ“ä½œé“¾:
1. é€‰æ‹©æ˜æ˜Ÿçƒå‘˜
2. æ”¾ç½®é¦–å¼ å¡ç‰Œ
3. æˆ˜æœ¯é˜¶æ®µé€‰æ‹©Pass
4. æ”¾ç½®æ›´å¤šå¡ç‰Œ
5. éªŒè¯æˆ˜æœ¯è¿æ¥
6. å°è¯•å°„é—¨
7. éªŒè¯å°„é—¨å‰Šå¼±
8. æ£€æŸ¥æ¯”åˆ†

**é¢„æœŸç»“æœ**: æµç¨‹é¡ºåˆ©å®Œæˆ,æ— å´©æºƒ

### T2: å°„é—¨æ ‡è®°å‰Šå¼±æœºåˆ¶
ä¸“é¡¹æµ‹è¯• **P0-1** ä¿®å¤æ•ˆæœ:
1. æ”¾ç½®é«˜æ”»å‡»åŠ›å¡ç‰Œ
2. è¿ç»­3æ¬¡å°„é—¨
3. è®°å½•æ¯æ¬¡æ”»å‡»åŠ›
4. éªŒè¯é€’å‡æ›²çº¿

**é¢„æœŸç»“æœ**: 
```
å°„é—¨1: æ”»å‡»åŠ› = 3
å°„é—¨2: æ”»å‡»åŠ› = 2
å°„é—¨3: æ”»å‡»åŠ› = 1
```

### T3: æˆ˜æœ¯å›¾æ ‡è¿æ¥
éªŒè¯ **P0-2** å¯è§†åŒ–æ•ˆæœ:
1. æ”¾ç½®é¦–å¼ å¡ â†’ æ— è¿æ¥çº¿
2. æ”¾ç½®ç›¸é‚»å¡ â†’ å‡ºç°è¿æ¥çº¿
3. éªŒè¯è¿æ¥æ•° â‰¥ 1

**é¢„æœŸç»“æœ**: SVGè¿æ¥çº¿æ­£ç¡®æ˜¾ç¤º

### T4: å‹åŠ›æµ‹è¯•
è¿ç»­10å›åˆæ“ä½œ,éªŒè¯ç¨³å®šæ€§:
- è‡ªåŠ¨é€‰æ‹©æ”¾ç½®å¡ç‰Œæˆ–å°„é—¨
- æ¯å›åˆè®°å½•æ¯”åˆ†
- æ£€æŸ¥æ— å†…å­˜æ³„æ¼

**é¢„æœŸç»“æœ**: 10å›åˆåæ¸¸æˆæ­£å¸¸è¿è¡Œ

### T5: é˜¶æ®µæ¨ªå¹…æç¤º
éªŒè¯ **P1-3** ä¼˜åŒ–æ•ˆæœ:
- DRAFT æ¨ªå¹…
- TACTICAL PHASE æ¨ªå¹…
- ACTION PHASE æ¨ªå¹…

**é¢„æœŸç»“æœ**: æ‰€æœ‰æ¨ªå¹…æŒ‰æ—¶æ˜¾ç¤º,å‰¯æ ‡é¢˜æ¸…æ™°

### T6: æ‹–æ‹½äº¤äº’
æµ‹è¯•éæ³•æ“ä½œæ‹’ç»:
- æ‹–æ‹½åˆ°å·²å ç”¨ä½ç½®
- æ‹–æ‹½åˆ°ä¸ç›¸é‚»ä½ç½®

**é¢„æœŸç»“æœ**: éæ³•æ“ä½œè¢«æ‹’ç»,å¡ç‰Œç•™åœ¨æ‰‹ç‰Œ

## ğŸ“Š æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npx playwright test

# è¿è¡Œç‰¹å®šæµ‹è¯•
npx playwright test game-full-flow.spec.ts

# è¿è¡Œç‰¹å®šç”¨ä¾‹
npx playwright test -g "T1: å®Œæ•´æ¸¸æˆæµç¨‹"

# è°ƒè¯•æ¨¡å¼ (å¸¦UI)
npx playwright test --debug

# åªè¿è¡Œå¤±è´¥çš„ç”¨ä¾‹
npx playwright test --last-failed

# ç”Ÿæˆä»£ç  (å½•åˆ¶æ“ä½œ)
npx playwright codegen http://localhost:5173
```

## ğŸ¥ æµ‹è¯•ç»“æœç¤ºä¾‹

### æˆåŠŸè¾“å‡º
```
Running 6 tests using 1 worker

  âœ“ [chromium] â€º game-full-flow.spec.ts:T1 å®Œæ•´æ¸¸æˆæµç¨‹ (15s)
  âœ“ [chromium] â€º game-full-flow.spec.ts:T2 å°„é—¨æ ‡è®°å‰Šå¼± (8s)
  âœ“ [chromium] â€º game-full-flow.spec.ts:T3 æˆ˜æœ¯å›¾æ ‡è¿æ¥ (6s)
  âœ“ [chromium] â€º game-full-flow.spec.ts:T4 å‹åŠ›æµ‹è¯• (25s)
  âœ“ [chromium] â€º game-full-flow.spec.ts:T5 é˜¶æ®µæ¨ªå¹… (5s)
  âœ“ [chromium] â€º game-full-flow.spec.ts:T6 æ‹–æ‹½äº¤äº’ (4s)

  6 passed (1.2m)
```

### å¤±è´¥æ—¶è‡ªåŠ¨ç”Ÿæˆ
- ğŸ“¸ **æˆªå›¾**: `playwright-report/` æˆ– `test-results/`
- ğŸ“ **Trace**: å¯åœ¨ trace æŸ¥çœ‹ (å¼€å¯ on-first-retry)

## ğŸ”§ CI/CDé›†æˆ

### GitHub Actions ç¤ºä¾‹
```yaml
name: E2E Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npx playwright install --with-deps
      - run: npx playwright test
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-results
          path: test-results/
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•è¶…æ—¶æ€ä¹ˆåŠ?
```typescript
// å¢åŠ ç‰¹å®šæ­¥éª¤çš„è¶…æ—¶æ—¶é—´
await helper.waitForGameReady({ timeout: 20000 });
```

### Q2: å¦‚ä½•è°ƒè¯•ç‰¹å®šæ­¥éª¤?
```typescript
// åœ¨æµ‹è¯•ä¸­æ·»åŠ æ–­ç‚¹
await page.pause(); // ä¼šæ‰“å¼€Playwright Inspector
```

### Q3: å¦‚ä½•è·³è¿‡AIå›åˆ?
```typescript
// ä½¿ç”¨ waitForTimeout ç­‰å¾…AIå®Œæˆ
await page.waitForTimeout(2000);
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

| æµ‹è¯•ç”¨ä¾‹ | é¢„æœŸæ—¶é•¿ | é€šè¿‡æ ‡å‡† |
|---------|---------|---------|
| T1 å®Œæ•´æµç¨‹ | ~15s | æ— å´©æºƒ |
| T2 å°„é—¨å‰Šå¼± | ~8s | å‰Šå¼±ç”Ÿæ•ˆ |
| T3 æˆ˜æœ¯è¿æ¥ | ~6s | è¿æ¥æ˜¾ç¤º |
| T4 å‹åŠ›æµ‹è¯• | ~25s | 10å›åˆç¨³å®š |
| T5 æ¨ªå¹…æç¤º | ~5s | å…¨éƒ¨æ˜¾ç¤º |
| T6 æ‹–æ‹½äº¤äº’ | ~4s | æ‹’ç»éæ³• |

**æ€»è€—æ—¶**: ~63ç§’ (å•æ ¸é¡ºåºæ‰§è¡Œ)

## ğŸ“ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ data-testid**: æ‰€æœ‰å¯äº¤äº’å…ƒç´ æ·»åŠ æµ‹è¯•æ ‡è¯†
2. **ç­‰å¾…åŠ¨ç”»å®Œæˆ**: æ¯æ¬¡æ“ä½œå `waitForTimeout(500)`
3. **éªŒè¯ä¸­é—´çŠ¶æ€**: ä¸åªéªŒè¯æœ€ç»ˆç»“æœ
4. **æˆªå›¾è®°å½•**: å…³é”®æ­¥éª¤è°ƒç”¨ `page.screenshot()`
5. **æ—¥å¿—è¾“å‡º**: ç”¨ `console.log` è®°å½•æµ‹è¯•è¿›åº¦

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ å¤šæµè§ˆå™¨æµ‹è¯• (Firefox, Safari)
- [ ] æ€§èƒ½ç›‘æ§ (FPS, å†…å­˜ä½¿ç”¨)
- [ ] ç§»åŠ¨ç«¯è§¦æ‘¸æ‰‹åŠ¿æµ‹è¯•
- [ ] ç½‘ç»œæ¡ä»¶æ¨¡æ‹Ÿ (æ…¢é€Ÿç½‘ç»œ)
- [ ] å¯è®¿é—®æ€§æµ‹è¯• (ARIA, é”®ç›˜å¯¼èˆª)

---

**Created**: 2026-02-11  
**Last Updated**: 2026-02-11  
**Version**: 1.0.0
